[workspace]
authors = ["Claude <noreply@anthropic.com>"]
channels = ["conda-forge"]
name = "blaze_zig"
platforms = ["linux-64"]
version = "0.1.0"

[dependencies]
# Build tools
cmake = ">=3.28"
ninja = ">=1.11"
git = ">=2.40"

# C++ compiler
cxx-compiler = ">=1.7"

# Intel MKL for BLAS/LAPACK
mkl = ">=2024"
mkl-devel = ">=2024"

# For downloading Zig
curl = ">=8.0"
xz = ">=5.4"

[tasks]
# Setup Blaze (header-only library)
setup-blaze = { cmd = "git clone --depth 1 https://bitbucket.org/blaze-lib/blaze.git external/blaze || true" }

# Download Zig from official site
setup-zig = { cmd = "bash -c 'test -f external/zig/zig || (mkdir -p external && curl -L https://ziglang.org/download/0.15.2/zig-x86_64-linux-0.15.2.tar.xz | tar -xJ -C external && mv external/zig-x86_64-linux-0.15.2 external/zig)'" }

# C++ tasks
configure-cpp = { cmd = "cmake -G Ninja -B build/cpp -S cpp -DCMAKE_BUILD_TYPE=Release", depends-on = ["setup-blaze"] }
build-cpp = { cmd = "cmake --build build/cpp", depends-on = ["configure-cpp"] }
run-cpp-example = { cmd = "./build/cpp/blaze_example", depends-on = ["build-cpp"] }
benchmark-cpp = { cmd = "./build/cpp/blaze_benchmark", depends-on = ["build-cpp"] }

# Zig tasks (use downloaded zig with MKL)
build-zig = { cmd = "../external/zig/zig build -Doptimize=ReleaseFast -Duse-mkl=true", cwd = "zig", depends-on = ["setup-zig"] }
run-zig-example = { cmd = "./zig-out/bin/blaze_example", cwd = "zig", depends-on = ["build-zig"] }
benchmark-zig = { cmd = "./zig-out/bin/blaze_benchmark", cwd = "zig", depends-on = ["build-zig"] }
test-zig = { cmd = "../external/zig/zig build test", cwd = "zig", depends-on = ["setup-zig"] }

# Combined tasks
benchmark-all = { depends-on = ["benchmark-cpp", "benchmark-zig"] }
