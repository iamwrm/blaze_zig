[workspace]
authors = ["Claude <noreply@anthropic.com>"]
channels = ["conda-forge"]
name = "blaze_zig"
platforms = ["linux-64"]
version = "0.1.0"

[dependencies]
# Build tools
cmake = ">=3.28"
ninja = ">=1.11"
git = ">=2.40"

# C++ compiler
cxx-compiler = ">=1.7"

# Intel MKL for BLAS/LAPACK (C++)
mkl = ">=2024"
mkl-devel = ">=2024"

# OpenBLAS for Zig (more compatible)
openblas = ">=0.3"

# For downloading Zig
curl = ">=8.0"
xz = ">=5.4"

[tasks]
# Setup Blaze (header-only library)
setup-blaze = { cmd = "git clone --depth 1 https://bitbucket.org/blaze-lib/blaze.git external/blaze || true" }

# Download Zig from official site (using 0.14.0 for better compatibility)
setup-zig = { cmd = "bash -c 'test -f external/zig/zig || (mkdir -p external && curl -L https://ziglang.org/download/0.14.0/zig-linux-x86_64-0.14.0.tar.xz | tar -xJ -C external && mv external/zig-linux-x86_64-0.14.0 external/zig)'" }

# C++ tasks
configure-cpp = { cmd = "cmake -G Ninja -B build/cpp -S cpp -DCMAKE_BUILD_TYPE=Release", depends-on = ["setup-blaze"] }
build-cpp = { cmd = "cmake --build build/cpp", depends-on = ["configure-cpp"] }
run-cpp-example = { cmd = "./build/cpp/blaze_example", depends-on = ["build-cpp"] }
benchmark-cpp = { cmd = "./build/cpp/blaze_benchmark", depends-on = ["build-cpp"] }

# Zig tasks - Pure Zig (no BLAS)
build-zig = { cmd = "../external/zig/zig build -Doptimize=ReleaseFast", cwd = "zig", depends-on = ["setup-zig"] }
run-zig-example = { cmd = "./zig-out/bin/blaze_example", cwd = "zig", depends-on = ["build-zig"] }
benchmark-zig = { cmd = "./zig-out/bin/blaze_benchmark", cwd = "zig", depends-on = ["build-zig"] }
test-zig = { cmd = "../external/zig/zig build test", cwd = "zig", depends-on = ["setup-zig"] }

# Zig tasks - with Intel MKL
build-zig-mkl = { cmd = "../external/zig/zig build -Doptimize=ReleaseFast -Dblas=mkl", cwd = "zig", depends-on = ["setup-zig"] }
run-zig-mkl-example = { cmd = "MKL_THREADING_LAYER=GNU ./zig-out/bin/blaze_example", cwd = "zig", depends-on = ["build-zig-mkl"] }
benchmark-zig-mkl = { cmd = "MKL_THREADING_LAYER=GNU ./zig-out/bin/blaze_benchmark", cwd = "zig", depends-on = ["build-zig-mkl"] }

# Zig tasks - with OpenBLAS
build-zig-openblas = { cmd = "../external/zig/zig build -Doptimize=ReleaseFast -Dblas=openblas", cwd = "zig", depends-on = ["setup-zig"] }
run-zig-openblas-example = { cmd = "./zig-out/bin/blaze_example", cwd = "zig", depends-on = ["build-zig-openblas"] }
benchmark-zig-openblas = { cmd = "./zig-out/bin/blaze_benchmark", cwd = "zig", depends-on = ["build-zig-openblas"] }

# Combined tasks
benchmark-all = { depends-on = ["benchmark-cpp", "benchmark-zig"] }
benchmark-all-blas = { depends-on = ["benchmark-cpp", "benchmark-zig-mkl"] }
